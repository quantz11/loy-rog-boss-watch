
{
  "entities": {
    "Boss": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Boss",
      "type": "object",
      "description": "Represents a boss in the Folkvang Watch application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Boss entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the boss."
        },
        "floorId": {
          "type": "string",
          "description": "Reference to Floor. (Relationship: Floor 1:N Boss)"
        },
        "serverType": {
          "type": "string",
          "description": "The type of server the boss is on (e.g., 'Inter-Server', 'Normal')."
        },
        "respawnTime": {
          "type": "number",
          "description": "The respawn time for the boss in hours.",
          "format": "number"
        }
      },
      "required": [
        "id",
        "name",
        "floorId",
        "serverType",
        "respawnTime"
      ]
    },
    "Floor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Floor",
      "type": "object",
      "description": "Represents a floor in Folkvang.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Floor entity."
        },
        "floorNumber": {
          "type": "number",
          "description": "The floor number (e.g., 1, 2, 3).",
          "format": "number"
        }
      },
      "required": [
        "id",
        "floorNumber"
      ]
    },
    "Timer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Timer",
      "type": "object",
      "description": "Represents a timer for a specific boss instance.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Timer entity."
        },
        "bossId": {
          "type": "string",
          "description": "Reference to Boss. (Relationship: Boss 1:N Timer)"
        },
        "defeatedTime": {
          "type": "string",
          "description": "The date and time the boss was defeated.",
          "format": "date-time"
        },
        "scheduledRespawnTime": {
          "type": "string",
          "description": "The scheduled respawn time of the boss, calculated based on the defeated time and respawn time.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "bossId",
        "defeatedTime",
        "scheduledRespawnTime"
      ]
    },
    "FCMToken": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FCMToken",
      "type": "object",
      "description": "Represents a Firebase Cloud Messaging (FCM) device token.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "The user ID associated with the token."
        },
        "token": {
          "type": "string",
          "description": "The FCM device token."
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the token was created.",
          "format": "date-time"
        }
      },
      "required": ["uid", "token", "createdAt"]
    },
    "LoginAttempt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LoginAttempt",
      "type": "object",
      "description": "Represents a logged failed login attempt after multiple failures.",
      "properties": {
        "userAgent": {
          "type": "string",
          "description": "The user agent string of the client that failed to log in."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp when the multiple failures occurred.",
          "format": "date-time"
        },
         "emailAttempted": {
          "type": "string",
          "description": "The email address that was used for the failed login attempt."
        },
        "language": {
            "type": "string",
            "description": "The language setting of the browser used for the failed login attempt."
        }
      },
      "required": ["userAgent", "timestamp", "emailAttempted", "language"]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/floors/{floorId}",
        "definition": {
          "entityName": "Floor",
          "schema": {
            "$ref": "#/backend/entities/Floor"
          },
          "description": "Stores floor information. floorId is the unique identifier for each floor.",
          "params": [
            {
              "name": "floorId",
              "description": "The unique identifier for the floor."
            }
          ]
        }
      },
      {
        "path": "/bosses/{bossId}",
        "definition": {
          "entityName": "Boss",
          "schema": {
            "$ref": "#/backend/entities/Boss"
          },
          "description": "Stores boss information, including floorId, serverType, and respawnTime. bossId is the unique identifier for each boss.",
          "params": [
            {
              "name": "bossId",
              "description": "The unique identifier for the boss."
            }
          ]
        }
      },
      {
        "path": "/timers/{timerId}",
        "definition": {
          "entityName": "Timer",
          "schema": {
            "$ref": "#/backend/entities/Timer"
          },
          "description": "Stores timer information for each boss, including defeatedTime and scheduledRespawnTime.  timerId is the unique identifier for each timer. bossId links to the Boss document.",
          "params": [
            {
              "name": "timerId",
              "description": "The unique identifier for the timer."
            }
          ]
        }
      },
      {
        "path": "/fcmTokens/{tokenId}",
        "definition": {
            "entityName": "FCMToken",
            "schema": {
                "$ref": "#/backend/entities/FCMToken"
            },
            "description": "Stores FCM device tokens for push notifications. The document ID is the token itself to prevent duplicates.",
            "params": [
                {
                    "name": "tokenId",
                    "description": "The FCM token string."
                }
            ]
        }
      },
       {
        "path": "/login-attempts/{attemptId}",
        "definition": {
            "entityName": "LoginAttempt",
            "schema": {
                "$ref": "#/backend/entities/LoginAttempt"
            },
            "description": "Stores information about multiple failed login attempts for security monitoring.",
            "params": [
                {
                    "name": "attemptId",
                    "description": "The unique identifier for the logged attempt."
                }
            ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to efficiently manage and query boss timers based on floors and server types. It uses structural segregation by separating different entities into their own collections. Authorization Independence is not applicable since there are no user roles or permissions required. Since the application uses anonymous authentication, access to read and write timers will be open, but could be restricted in the security rules to prevent abuse if needed. The `Floors` collection stores floor information. `Bosses` stores boss information and their relationship to floors via the `floorId` field. `Timers` stores timer information and relates back to the boss via `bossId`. The `fcmTokens` collection stores device tokens for sending push notifications. The `login-attempts` collection is write-only for clients to log suspicious activity."
  }
}
