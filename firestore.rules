
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Floors and Bosses are public, static data.
    // They can be read by anyone, but not written by clients.
    match /floors/{floorId} {
      allow read: if true;
      allow write: if false;
    }

    match /bosses/{bossId} {
      allow read: if true;
      allow write: if false;
    }

    // Timers are dynamic and should be readable and writable by any user,
    // as the app uses anonymous authentication for a shared, public state.
    match /timers/{timerId} {
      allow read, write: if true;
    }
    
    // Allow anyone to write to the login-attempts collection to log failures.
    // Read access should be disabled for clients.
    match /login-attempts/{attemptId} {
      allow create: if true;
      allow read, update, delete: if false;
    }

    // Rules for FCM tokens.
    // The document ID is the token itself.
    match /fcmTokens/{token} {
      // A user can create a token document for themselves.
      allow create: if request.auth != null && request.resource.data.uid == request.auth.uid;
      // A user can only read their own token document.
      allow read: if request.auth != null && resource.data.uid == request.auth.uid;
      // A user can update their own token document (e.g., to update a timestamp).
      allow update: if request.auth != null && resource.data.uid == request.auth.uid;
      // Users cannot delete tokens.
      allow delete: if false;
    }
  }
}
